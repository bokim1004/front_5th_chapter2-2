import{j as n,R as v,r as g,c as V}from"./client-DD4c7S6m.js";const T=({title:e,children:t})=>n.jsxs("div",{className:"container mx-auto p-4",children:[n.jsx("h1",{className:"text-3xl font-bold mb-6",children:e}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t})]}),l=({children:e,onClick:t,className:s="",...o})=>n.jsx("button",{onClick:t,className:s,...o,children:e}),q=({title:e,children:t})=>n.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[n.jsx("h2",{className:"text-2xl font-semibold mb-2",children:e}),t]}),j=({id:e,label:t,type:s="text",value:o,onChange:a,wrapperClassName:c,labelClassName:r})=>n.jsxs("div",{className:c,children:[n.jsx("label",{htmlFor:e,className:r,children:t}),n.jsx("input",{id:e,type:s,value:o,onChange:a,className:"w-full p-2 border rounded"})]}),N=({type:e="text",value:t,placeholder:s,onChange:o,className:a})=>n.jsx("input",{type:e,value:t,placeholder:s,onChange:o,className:a}),y=({children:e,className:t=""})=>n.jsx("div",{className:`space-y-2 ${t}`,children:e}),w=({title:e,children:t})=>n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-semibold mb-4",children:e}),t]}),$=({coupon:e,onChange:t,onSubmit:s})=>n.jsxs("div",{className:"space-y-2 mb-4",children:[n.jsx(N,{placeholder:"쿠폰 이름",value:e.name,onChange:o=>t({...e,name:o.target.value}),className:"w-full p-2 border rounded"}),n.jsx(N,{placeholder:"쿠폰 코드",value:e.code,onChange:o=>t({...e,code:o.target.value}),className:"w-full p-2 border rounded"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("select",{value:e.discountType,onChange:o=>t({...e,discountType:o.target.value}),className:"w-full p-2 border rounded",children:[n.jsx("option",{value:"amount",children:"금액(원)"}),n.jsx("option",{value:"percentage",children:"할인율(%)"})]}),n.jsx(N,{type:"number",placeholder:"할인 값",value:e.discountValue,onChange:o=>t({...e,discountValue:parseInt(o.target.value)}),className:"w-full p-2 border rounded"})]}),n.jsx(l,{onClick:s,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),R=(e,t)=>t?t.discountType==="amount"?Math.max(0,e-t.discountValue):e*(1-t.discountValue/100):e,U=e=>e.reduce((t,s)=>t+s.product.price*s.quantity,0),L=e=>e.reduce((t,s)=>{const{price:o,discounts:a}=s.product,{quantity:c}=s,r=a.filter(d=>c>=d.quantity).reduce((d,u)=>Math.max(d,u.rate),0);return t+o*c*(1-r)},0),B=(e,t)=>{const s=U(e),o=L(e),a=R(o,t),c=s-a;return{totalBeforeDiscount:Math.round(s),totalAfterDiscount:Math.round(a),totalDiscount:Math.round(c)}},P=e=>{let t;const s=new Set,o=(i,p)=>{const m=typeof i=="function"?i(t):i;if(!Object.is(m,t)){const x=t;t=p??(typeof m!="object"||m===null)?m:Object.assign({},t,m),s.forEach(b=>b(t,x))}},a=()=>t,d={setState:o,getState:a,getInitialState:()=>u,subscribe:i=>(s.add(i),()=>s.delete(i))},u=t=e(o,a,d);return d},Q=e=>e?P(e):P,O=e=>e;function W(e,t=O){const s=v.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return v.useDebugValue(s),s}const S=e=>{const t=Q(e),s=o=>W(t,o);return Object.assign(s,t),s},I=e=>e?S(e):S,E=(e,t)=>{const s=t.find(o=>o.product.id===e.id);return e.stock-((s==null?void 0:s.quantity)||0)},z=(e,t)=>E(t,e)<=0?e:e.find(a=>a.product.id===t.id)?e.map(a=>a.product.id===t.id?{...a,quantity:Math.min(a.quantity+1,t.stock)}:a):[...e,{product:t,quantity:1}],K=(e,t)=>e.filter(s=>s.product.id!==t),_=(e,t,s)=>e.map(o=>{if(o.product.id===t){const a=o.product.stock,c=Math.max(0,Math.min(s,a));return c>0?{...o,quantity:c}:null}return o}).filter(o=>o!==null),G=I((e,t)=>({cart:[],addToCart:s=>{const o=z(t().cart,s);e({cart:o})},removeFromCart:s=>{const o=K(t().cart,s);e({cart:o})},updateQuantity:(s,o)=>{const a=_(t().cart,s,o);e({cart:a})},resetCart:()=>e({cart:[]})})),H=()=>{const[e,t]=g.useState(null);return{selectedCoupon:e,applyCoupon:o=>{t(o)}}},J=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],k={name:"",code:"",discountType:"percentage",discountValue:0},X=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],D={name:"",price:0,stock:0,discounts:[]},F=()=>{const[e,t]=g.useState(J),[s,o]=g.useState(k),a=i=>{t(p=>[...p,i])},c=i=>{t(i)},r=()=>{o(k)};return{coupons:e,addCoupon:a,newCoupon:s,initializeCoupons:c,updateNewCoupon:i=>{o(i)},handleAddCoupon:()=>{a(s),r()}}},Y=(e,t)=>[...e,t],Z=(e,t)=>e.map(s=>s.id===t.id?t:s),tt=(e,t,s)=>{const o=e.find(a=>a.id===t);return o?{...o,stock:s}:null},et=e=>({...e,id:Date.now().toString()}),h=I((e,t)=>({products:X,newProduct:D,showNewProductForm:!1,editingProduct:null,initializeProducts:s=>e({products:s}),addProduct:s=>{const o=Y(t().products,s);e({products:o})},updateProduct:s=>{const o=Z(t().products,s);e({products:o})},updateEditingProduct:s=>e({editingProduct:s}),handleStockUpdate:(s,o)=>{const{updateEditingProduct:a,updateProduct:c}=t(),r=tt(t().products,s,o);r&&(c(r),a(r))},updateNewProduct:s=>e({newProduct:s}),handleAddNewProduct:()=>{const{newProduct:s,addProduct:o}=t(),a=et(s);o(a),e({newProduct:D,showNewProductForm:!1})},toggleNewProductForm:()=>{const{showNewProductForm:s}=t();e({showNewProductForm:!s})}})),nt=()=>{const[e,t]=g.useState({quantity:0,rate:0}),{products:s,updateProduct:o,editingProduct:a,updateEditingProduct:c}=h(),r=()=>{t({quantity:0,rate:0})};return{newDiscount:e,resetNewDiscount:r,updateNewDiscount:p=>{t(p)},handleAddDiscount:p=>{const m=s.find(x=>x.id===p);if(m&&a){const x={...m,discounts:[...m.discounts,e]};o(x),c(x),r()}},handleRemoveDiscount:(p,m)=>{const x=s.find(b=>b.id===p);if(x){const b={...x,discounts:x.discounts.filter((Pt,M)=>M!==m)};o(b),c(b)}}}},st=(e,t)=>g.useMemo(()=>B(e,t),[e,t]),A=()=>{const{updateProduct:e,editingProduct:t,updateEditingProduct:s}=h();return{handleEditProduct:d=>{s({...d})},handleProductNameUpdate:(d,u)=>{if(t&&t.id===d){const i={...t,name:u};s(i)}},handlePriceUpdate:(d,u)=>{if(t&&t.id===d){const i={...t,price:u};s(i)}},handleEditComplete:()=>{t&&(e(t),s(null))}}},ot=(e=new Set)=>{const[t,s]=g.useState(e);return{openToggle:t,handleToggleClick:a=>{s(c=>{const r=new Set(c);return r.has(a)?r.delete(a):r.add(a),r})}}},f=(e,t="원")=>`${e.toLocaleString("ko-KR")}${t}`,at=e=>`${e}%`,ct=()=>{const{coupons:e,newCoupon:t,updateNewCoupon:s,handleAddCoupon:o}=F();return n.jsx(w,{title:"쿠폰 관리",children:n.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[n.jsx($,{coupon:t,onChange:s,onSubmit:o}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),n.jsx(y,{children:e.map((a,c)=>n.jsxs("div",{"data-testid":`coupon-${c+1}`,className:"bg-gray-100 p-2 rounded",children:[a.name," (",a.code,"):",a.discountType==="amount"?f(a.discountValue):at(a.discountValue),""," 할인"]},c))})]})]})})},rt=()=>{const{newProduct:e,updateNewProduct:t,handleAddNewProduct:s}=h();return n.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[n.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),n.jsx(j,{wrapperClassName:"mb-2",labelClassName:"block text-sm font-medium text-gray-700",id:"productName",label:"상품명",type:"text",value:e.name,onChange:o=>t({...e,name:o.target.value})}),n.jsx(j,{wrapperClassName:"mb-2",labelClassName:"block text-sm font-medium text-gray-700",id:"productPrice",label:"가격",type:"number",value:e.price,onChange:o=>t({...e,price:parseInt(o.target.value)})}),n.jsx(j,{wrapperClassName:"mb-2",labelClassName:"block text-sm font-medium text-gray-700",id:"productStock",label:"재고",type:"number",value:e.stock,onChange:o=>t({...e,stock:parseInt(o.target.value)})}),n.jsx(l,{onClick:s,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]})},C=e=>Math.round(e*100),dt=e=>e/100,it=({discount:e,onChange:t,onSubmit:s})=>n.jsxs("div",{className:"flex space-x-2",children:[n.jsx(N,{type:"number",placeholder:"수량",value:e.quantity,onChange:o=>t({...e,quantity:parseInt(o.target.value)}),className:"w-1/3 p-2 border rounded"}),n.jsx(N,{type:"number",placeholder:"할인율 (%)",value:C(e.rate),onChange:o=>t({...e,rate:dt(parseInt(o.target.value))}),className:"w-1/3  p-2 border rounded"}),n.jsx(l,{onClick:s,className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]}),ut=e=>{const{editingProduct:t,product:s}=e,{handleRemoveDiscount:o,updateNewDiscount:a,handleAddDiscount:c,newDiscount:r}=nt();return n.jsxs("div",{children:[n.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),t.discounts.map((d,u)=>n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsxs("span",{children:[d.quantity,"개 이상 구매 시 ",C(d.rate),"% 할인"]}),n.jsx(l,{onClick:()=>o(s.id,u),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},u)),n.jsx(it,{discount:r,onChange:a,onSubmit:()=>c(s.id)})]})},lt=e=>{const{editingProduct:t,product:s}=e,{handleEditComplete:o,handleProductNameUpdate:a,handlePriceUpdate:c}=A(),{handleStockUpdate:r}=h();return n.jsxs("div",{children:[n.jsx(j,{wrapperClassName:"mb-4",labelClassName:"block mb-1",label:"상품명: ",type:"text",value:t.name,onChange:d=>a(s.id,d.target.value)}),n.jsx(j,{wrapperClassName:"mb-4",labelClassName:"block mb-1",label:"가격: ",type:"number",value:t.price,onChange:d=>c(s.id,parseInt(d.target.value))}),n.jsx(j,{wrapperClassName:"mb-4",labelClassName:"block mb-1",label:"재고: ",type:"number",value:t.stock,onChange:d=>r(s.id,parseInt(d.target.value))}),n.jsx(ut,{editingProduct:t,product:s}),n.jsx(l,{onClick:o,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]})},pt=e=>{const{product:t,index:s}=e,{openToggle:o,handleToggleClick:a}=ot(),{editingProduct:c}=h(),{handleEditProduct:r}=A(),d=o.has(t.id),u=(c==null?void 0:c.id)===t.id;return n.jsxs("div",{"data-testid":`product-${s+1}`,className:"bg-white p-4 rounded shadow",children:[n.jsxs(l,{"data-testid":"toggle-button",onClick:()=>a(t.id),className:"w-full text-left font-semibold",children:[t.name," - ",f(t.price)," (재고: ",t.stock,")"]}),d&&n.jsx("div",{className:"mt-2",children:u?n.jsx(lt,{editingProduct:c,product:t}):n.jsxs("div",{children:[t.discounts.map((i,p)=>n.jsx("div",{className:"mb-2",children:n.jsxs("span",{children:[i.quantity,"개 이상 구매 시 ",C(i.rate),"% 할인"]})},p)),n.jsx(l,{"data-testid":"modify-button",onClick:()=>r(t),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},t.id)},mt=()=>{const{products:e}=h();return n.jsx(y,{children:e.map((t,s)=>n.jsx(pt,{product:t,index:s},t.id))})},xt=()=>{const{showNewProductForm:e,toggleNewProductForm:t}=h();return n.jsxs(w,{title:"상품 관리",children:[n.jsx(l,{onClick:t,className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:e?"취소":"새 상품 추가"}),e&&n.jsx(rt,{}),n.jsx(mt,{})]})},ht=()=>n.jsxs(T,{title:"관리자 페이지",children:[n.jsx(xt,{}),n.jsx(ct,{})]}),gt=e=>{const{selectedCoupon:t,applyCoupon:s}=e,{coupons:o}=F();return n.jsxs(q,{title:"쿠폰 적용",children:[n.jsxs("select",{onChange:a=>s(o[parseInt(a.target.value)]),className:"w-full p-2 border rounded mb-2",children:[n.jsx("option",{value:"",children:"쿠폰 선택"}),o.map((a,c)=>n.jsxs("option",{value:c,children:[a.name," -"," ",a.discountType==="amount"?`${a.discountValue}원`:`${a.discountValue}%`]},a.code))]}),t&&n.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",t.name,"(",t.discountType==="amount"?`${t.discountValue}원`:`${t.discountValue}%`," ","할인)"]})]})},bt=e=>e.reduce((t,s)=>Math.max(t,s.rate),0),jt=e=>e.product.discounts.filter(t=>e.quantity>=t.quantity).reduce((t,s)=>Math.max(t,s.rate),0),Nt=e=>{const{cart:t}=e,{updateQuantity:s,removeFromCart:o}=e.actions;return n.jsx(y,{children:t.map(a=>{const c=jt(a);return n.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:a.product.name}),n.jsx("br",{}),n.jsxs("span",{className:"text-sm text-gray-600",children:[a.product.price,"원 x ",a.quantity,c>0&&n.jsxs("span",{className:"text-green-600 ml-1",children:["(",(c*100).toFixed(0),"% 할인 적용)"]})]})]}),n.jsxs("div",{children:[n.jsx(l,{onClick:()=>s(a.product.id,a.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),n.jsx(l,{onClick:()=>s(a.product.id,a.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),n.jsx(l,{onClick:()=>o(a.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]},a.product.id)})})},yt=({cart:e,selectedCoupon:t})=>{const{totalBeforeDiscount:s,totalAfterDiscount:o,totalDiscount:a}=st(e,t);return n.jsx(q,{title:"주문 요약",children:n.jsxs("div",{className:"space-y-1",children:[n.jsxs("p",{children:["상품 금액: ",s.toLocaleString(),"원"]}),n.jsxs("p",{className:"text-green-600",children:["할인 금액: ",a.toLocaleString(),"원"]}),n.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",o.toLocaleString(),"원"]})]})})},wt=e=>{const{cart:t,actions:s}=e,{updateQuantity:o,removeFromCart:a}=s,{selectedCoupon:c,applyCoupon:r}=H();return n.jsxs(w,{title:"장바구니 내역",children:[n.jsx(Nt,{cart:t,actions:{updateQuantity:o,removeFromCart:a}}),n.jsx(gt,{selectedCoupon:c,applyCoupon:r}),n.jsx(yt,{cart:t,selectedCoupon:c})]})},Ct=({products:e,cart:t,addToCart:s})=>n.jsx(w,{title:"상품 목록",children:n.jsx(y,{children:e.map(o=>{const a=E(o,t);return n.jsxs("div",{"data-testid":`product-${o.id}`,className:"bg-white p-3 rounded shadow",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold",children:o.name}),n.jsx("span",{className:"text-gray-600",children:f(o.price)})]}),n.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[n.jsxs("span",{className:`font-medium ${a>0?"text-green-600":"text-red-600"}`,children:["재고: ",a,"개"]}),o.discounts.length>0&&n.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(bt(o.discounts)*100).toFixed(0),"% 할인"]})]}),o.discounts.length>0&&n.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:o.discounts.map((c,r)=>n.jsxs("li",{children:[c.quantity,"개 이상: ",C(c.rate),"% 할인"]},r))}),n.jsx(l,{onClick:()=>s(o),className:`w-full px-3 py-1 rounded ${a>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:a<=0,children:a>0?"장바구니에 추가":"품절"})]},o.id)})})}),vt=()=>{const{cart:e,addToCart:t,removeFromCart:s,updateQuantity:o}=G(),{products:a}=h();return n.jsxs(T,{title:"장바구니",children:[n.jsx(Ct,{products:a,cart:e,addToCart:t}),n.jsx(wt,{cart:e,actions:{updateQuantity:o,removeFromCart:s}})]})},ft=()=>{const[e,t]=g.useState(!1);return n.jsxs("div",{className:"min-h-screen bg-gray-100",children:[n.jsx("nav",{className:"bg-blue-600 text-white p-4",children:n.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[n.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),n.jsx(l,{onClick:()=>t(!e),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:e?"장바구니 페이지로":"관리자 페이지로"})]})}),n.jsx("main",{className:"container mx-auto mt-6",children:e?n.jsx(ht,{}):n.jsx(vt,{})})]})};V.createRoot(document.getElementById("root")).render(n.jsx(v.StrictMode,{children:n.jsx(ft,{})}));
